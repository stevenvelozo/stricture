# Stricture Legacy Compiler

Stricture is a MicroDDL (Micro Data Definition Language) compiler. It parses
a simple, Markdown-inspired, database-agnostic schema definition language and
generates multiple output formats: JSON models, SQL scripts, documentation,
relationship diagrams and code scaffolding.

## Quick Start

```bash
node Stricture.js -i Model.mddl -c Full
```

This compiles `Model.mddl` through the full pipeline, producing MySQL scripts,
Meadow schemas, Markdown documentation and relationship diagrams in the
`./model/` directory.

## Command Line Options

| Flag | Option             | Default          | Description                              |
|------|--------------------|------------------|------------------------------------------|
| `-c` | Command            | `Full`           | Command to execute (see below)           |
| `-i` | InputFileName      | `./Model.ddl`    | Input MicroDDL or JSON model file        |
| `-f` | OutputLocation     | `./model/`       | Output directory                         |
| `-o` | OutputFileName     | `MeadowModel`    | Output file prefix                       |
| `-g` | AutomaticallyCompile | `false`        | Auto-generate images from DOT files      |
| `-l` | AutomaticallyLoad  | `false`          | Auto-open generated images in the OS     |

## Available Commands

| Command               | Description                                      |
|-----------------------|--------------------------------------------------|
| `Compile`             | Parse MicroDDL to JSON model files               |
| `Full`                | End-to-end pipeline (Compile + all generators)   |
| `MySQL`               | Generate MySQL CREATE TABLE statements           |
| `MySQL-Migrate`       | Generate MySQL INSERT...SELECT migration stubs   |
| `Meadow`              | Generate per-table Meadow schema JSON files      |
| `Documentation`       | Generate Markdown data dictionary                |
| `DataDictionary`      | Generate LaTeX data dictionary                   |
| `DictionaryCSV`       | Generate CSV data dictionary                     |
| `Relationships`       | Generate Graphviz relationship diagram           |
| `RelationshipsFull`   | Generate Graphviz diagram with audit joins       |
| `Authorization`       | Generate CSV authorization/permission matrix     |
| `Pict`                | Generate RequireJS PICT UI model                 |
| `TestObjectContainers`| Generate per-table test fixture JSON files       |
| `Info`                | List all tables in the model (default)           |

## Input Formats

Most commands except `Compile` and `Full` expect a JSON model file as input
(the output of a prior `Compile` step). The `Compile` and `Full` commands
accept MicroDDL (`.mddl` / `.ddl`) files.

See [MicroDDL-Syntax.md](MicroDDL-Syntax.md) for the full MicroDDL language
reference.

## Two-Phase Workflow

Stricture uses a two-phase approach:

1. **Compile** -- Parse MicroDDL text into an intermediate JSON model
2. **Generate** -- Read the JSON model and produce output artifacts

The `Full` command chains both phases automatically. When running individual
generator commands, you typically point `-i` at the Extended JSON model file
produced by a prior `Compile`.

## Output Directory Structure (Full Command)

```
model/
  MeadowModel.json              # Basic table model
  MeadowModel-Extended.json     # Full model with auth, endpoints, PICT config
  MeadowModel-PICT.json         # PICT UI definitions
  mysql_create/
    MeadowModel-CreateMySQLDatabase.mysql.sql
  meadow/
    MeadowSchemaTableName.json   # One per table
  doc/
    Documentation-Dictionary.md
    Documentation-Model-*.md     # One per table
    Documentation-ModelChangeTracking.md
    diagrams/
      Relationships.dot
      Relationships.png
      RelationshipsFull.dot
      RelationshipsFull.png
```

## Docuserve Integration

The Stricture model feeds into pict-docuserve (the documentation viewer)
through several configuration files generated by Indoctrinate:

- `retold-catalog.json` -- master catalog of module groups and documentation
- `cover.md` -- splash page content (title, tagline, highlights, action buttons)
- `_sidebar.md` -- markdown-based sidebar navigation
- `_topbar.md` -- top bar branding and navigation links
- `errorpage.md` -- custom 404 page
- `retold-keyword-index.json` -- Lunr.js search index

See [Docuserve-Configuration.md](Docuserve-Configuration.md) for the full
specification of each file format.
